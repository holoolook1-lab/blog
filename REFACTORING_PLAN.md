# 리팩토링 마스터 플랜

목표: 중복·불필요 파일 제거, 모듈·경로 체계화, 성능·안정성 개선, UI/UX 디자인 시스템 통일.

## 범위
- 메인 앱: `blog/` 디렉터리 중심으로 통합 운영.
- 공통 유틸: `blog/src/lib/` 하위로 집약(`slug.ts` 등).
- API·페이지·컴포넌트 구조 표준화 및 에러 처리·상태 관리 일관화.

## 대상 폴더 구조(제안)
- `blog/src/app/` — 라우트(RSC), 도메인 세그먼트(`(blog)`, `(settings)`, `api`)
- `blog/src/components/` — UI 컴포넌트(`common`, `blog`, `editor`, `profile`)
- `blog/src/lib/` — 공통 유틸/도메인 로직(`slug.ts`, `utils/*`, `supabase/*`, `date.ts`, `site.ts`)
- `blog/src/types/` — 도메인 타입
- `blog/public/` — 정적 에셋

## 네이밍 규칙
- 파일/폴더: `kebab-case` (`post-card.tsx`), 컴포넌트: `PascalCase`, 함수/변수: `camelCase`, 타입: `PascalCase`.
- 라우트 세그먼트는 의미 중심 그룹화.

## 아키텍처 일관화
- 페이지(RSC)에 데이터 로드 집중, 상호작용은 클라이언트 컴포넌트로 위임.
- API 라우트는 입력 검증·표준 에러 응답을 유지하고 도메인 로직을 `lib/`로 분리.
- 상태 관리: 서버 컴포넌트 우선, 글로벌은 경량 컨텍스트로 표준화.
- 에러 응답 포맷: `{ error: string, code?: string, detail?: any }`.

## 성능 최적화
- Supabase 인덱스 확인: `posts.slug UNIQUE`, `posts.created_at INDEX`.
- 목록 조회 필드 최소화·중복 제거·정렬 일관화.
- 이미지 최적화(`next/image`), 지연 로딩 적절화, 캐시 재검증 간격 도메인별 통일.

## 테스트 전략 (중단)
조직 정책에 따라 테스트 실행·테스트 인프라를 전면 중단했습니다. 개발·수정·기능 보완에만 집중하며, 테스트 수행은 운영자/사용자 측에서 진행합니다.

## 품질 기준
- 타입 에러 0, ESLint 워닝 0, 포맷 일치.
- 유틸/라우트 커버리지 ≥80%, 주요 UI ≥60%.
- 한글 슬러그 상세 접근 100% 성공, RSS/Atom 링크 정상화.
- 성능 계측 지표 개선(첫 로드·상호작용).

## 단계별 체크리스트 및 예상 소요
1. 구조·규칙 정립(0.5~1일, 높음)
   - 공통 유틸 단일화(`blog/src/lib`), 경로 alias 점검, 네이밍 가이드 배포.
2. API·페이지 표준화(1~2일, 높음)
   - 입력 검증·에러 포맷 통일, 슬러그 디코드+정규화 재검증.
3. 성능·스타일(1일, 중간)
   - 이미지 최적화·리렌더 줄이기, ESLint/Prettier 적용.
4. 테스트(1~2일, 높음)
   - 유틸/라우트/피드 테스트 추가·커버리지 보고.
5. UI/UX 통일(1일, 중간)
   - 디자인 토큰 정의, 공통 컴포넌트 치환.

## 마이그레이션·롤백
- 모듈 이동 후 임포트 경로 자동 리팩토링, 타입 체크·빌드 검증.
- 변경 단위별 패치 묶음 유지, 실패 시 alias로 기존 경로 임시 재매핑.

---

## 현재 진행 상태(업데이트)
- 중복 슬러그 유틸 제거: `src/lib/slug.ts` 삭제, 단일 소스 `blog/src/lib/slug.ts` 유지.
- 테스트 인프라 제거: `blog/test/` 폴더, `vitest.config.ts` 삭제, `package.json` 테스트 스크립트 및 devDependencies(vitest/testing-library/jsdom/coverage) 제거.
- 코드 스타일: Prettier 설정 추가(`.prettierrc.json`), 포맷 스크립트 유지.

## 실행 스크립트
- `npm run format` — 코드 자동 포맷.
- `npm run lint:fix` — 린트 자동 수정.
- `npm run typecheck` — 타입 체크(무출력).

> 참고: 테스트 관련 스크립트는 정책상 삭제되었습니다.

## 리스크·완화·롤백 상세
- 리스크: 임포트 경로 누락, 환경 변수 미설정, 이미지 변환 파라미터 오류.
- 완화: 전수 검색으로 임포트 확인, Supabase 스텁 유지, 변환 실패 시 원본 URL 반환.
- 롤백: 변경은 커밋 단위; 문제가 생기면 이전 커밋으로 되돌리거나 기능 단위 revert 수행.

## 폴더 구조 가이드(한국어 프로젝트 최적화)

- 원칙
  - 변경 독립성 높은 단위(도메인/기능/페이지)로 폴더를 그룹화합니다.
  - 재사용 유틸은 `blog/src/lib` 하위에 두고, 라우트/페이지별 로직은 각 `app/...` 하위에 둡니다.
  - 깊은 경로를 줄이기 위해 `@/*` 경로 별칭과 필요한 곳에 배럴 파일(`index.ts`)을 사용합니다.
  - 파일은 하나의 책임에 집중시키되, 지나친 분리로 탐색성이 저하되면 배럴/하위 모듈로 완화합니다.

- 권장 구조(요지)
  - `src/app`: 라우트/페이지(Pages, API). 페이지별 컴포넌트는 하위 폴더로 묶음
  - `src/components`: 공유 UI 컴포넌트(프리젠테이션)
  - `src/lib`: 유틸리티/서비스(예: `slug.ts`, `api.ts`, `supabase/`)
  - `src/types`: 타입 정의(공유 인터페이스/DTO)
  - `test`: 유닛/통합 테스트, `test/setup.ts`로 환경 공통화

- 언제 합치고 언제 나눌까
  - 합치기: 파일 수가 많지만 변경이 항상 함께 발생하는 경우(강한 결합), 검색/탐색이 어려울 때 배럴로 노출
  - 나누기: 함수/컴포넌트 책임이 다른 경우, 테스트/배포 단위가 달라지는 경우, 순환 참조 조짐이 보일 때

- 실무 팁
  - Import 안정화: `@/lib/...` 만 사용하도록 로컬 상대 경로는 최소화
  - 배럴 주의: 과도한 재노출은 트리쉐이킹을 방해할 수 있으므로 목적 있는 레벨에만 배치
  - 한국어 대응: 한글 슬러그/날짜/로케일 유틸은 `lib`로 공통화하고, 페이지에서는 헬퍼만 호출
