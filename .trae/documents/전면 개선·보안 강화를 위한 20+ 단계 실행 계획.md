## 목표
- 기존 기능(로그인/권한, 댓글 리얼타임, 업로드)을 유지하면서 보안(CSP), 성능, 권한 일관성을 단계적으로 전면 강화
- 한번에 수행 가능한 세부 작업 20개 이상을 나열해 병렬/순차 진행합니다

## 1) 모니터링/로그 기반 보강
1. Report-Only CSP 리포트 집계 파이프라인 정리(엔드포인트 응답/로그 형식 확정)
2. 브라우저 콘솔/네트워크에서 CSP 헤더·WebSocket 연결 상태 점검 기준 수립
3. 주요 흐름(홈/게시글/작성/댓글) 시나리오로 위반 리포트 수집 24시간 운영

## 2) CSP Enforce 1차(핵심 페이지)
4. 홈(/), 작성(/write), 상세(/posts/[slug])에 경로별 `script-src 'self' 'nonce-…'` 적용
5. `connect-src` 최소화: `https: wss: <supabase-host>` + 필요한 외부 도메인만 유지
6. `frame-src` 정리: YouTube/Vimeo/Twitch 등 실제 필요 도메인만 유지
7. 레이아웃의 JSON-LD `<script>`에 요청별 nonce 일괄 반영(이미 적용된 부분 재확인)

## 3) 인라인 제거/치환(점진)
8. 인라인 `<script>` 전수 조사 → 제거 또는 `nonce/hash` 적용
9. 인라인 `<style>`/스타일 속성 사용 지점 파악 → 클래스로 치환 또는 `nonce/hash`
10. 외부 스크립트/스타일 로더 사용 시 `integrity`/`crossorigin` 점검

## 4) CSP Enforce 2차(확대)
11. 목록(/posts), 개인 페이지(/mypage), 정책(/privacy, /terms)로 Enforce 확대
12. Report-Only와 Enforce 중복 유지 기간 설정(7일) 후 Report-Only 제거
13. 예외 경로(임베드가 많은 페이지)는 별도 정책 또는 동적 허용 집합 적용

## 5) Supabase 권한/세션 일관성 확증
14. 비밀번호 로그인 후 서버·클라이언트 세션 동기화 검증(재로그인/새로고침/다중 탭)
15. RLS 정책 점검: posts/comments UPDATE/DELETE는 `auth.uid() = user_id`만 허용
16. 보호 라우팅(미들웨어) 환경변수 가드 재검토·경계 테스트(누락 시 graceful)

## 6) 댓글 리얼타임 최적화
17. `postgres_changes` 이벤트를 `insert/update/delete`로 제한 유지(중복 로딩 억제)
18. 수동 로딩 이후 억제 타이머(`suppressRealtimeUntil`) 동작 확인(경합 시나리오 테스트)

## 7) 업로드 정책 단일화(WebP)
19. 클라이언트 WebP 변환 실패 시 사용자 피드백 개선(힌트 메시지 표시)
20. Storage 버킷 Public 재확인 및 캐시 헤더 검토(이미지 전송 최적화)

## 8) 성능 개선(데이터·렌더)
21. 목록 API 페이로드 축소 유지(`content` 제외) 및 페이지 크기(12) 검증
22. 검색(q) 성능 점검 → 필요 시 `title.ilike` 우선 옵션 제공
23. ISR/태그 재검증 간격 재평가(트래픽 패턴에 따라 60→90/120 조정)

## 9) RPC/타입 강화(선택, 코드 증량 없이 품질↑)
24. Supabase 타입 자동 생성(CLI) 도입 → 현재 최소 타입과 병행 후 완전 전환
25. 댓글 삽입 검증 로직을 RPC로 단일화(이미 폴백 도입, RPC 생성 시 전환)

## 10) 배포·롤백·운영
26. 단계별 배포 체크리스트(핵심 경로 테스트, Realtime, 업로드, 신고 메일)
27. 문제가 생기면 해당 경로를 즉시 Report-Only로 되돌리는 롤백 스위치 유지
28. 변경 이력·운영 문서 간단 정리(개발자용)

## 11) 확장
29. 이미지 최적화 옵션 재검토(Next 이미지 최적화 재활성화 고려, 실제 호환 확인 후 적용)
30. 외부 임베드 플랫폼 추가 필요 시 도메인 화이트리스트에 최소 범위로 반영

위 단계로 한 번에 진행하겠습니다. 문제가 생기면 경로별 Report-Only로 되돌리고 해당 지점만 수정해 재적용하는 방식으로 안전하게 확대합니다.